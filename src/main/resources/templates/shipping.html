<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <!-- <link rel="stylesheet" href="src\main\resources\public\stylesheets\shipping.css"> -->
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous"> -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="shortcut icon" href="#">
    <!-- <script src="shipCharges.js"></script> -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script  defer src="https://maps.googleapis.com/maps/api/js?libraries=places&language=en&key=AIzaSyAhqXA-l1gUCnZ407-3Cr_Hqrb8JyIv7bk&callback=initMap"  type="text/javascript"></script>
    <!-- <script defer src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&libraries=places"></script> -->
</head>
<style>
    h1{
    padding-top: 0px;
    padding-left:10px;
    font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
}
h2{
    padding-top:0px;  
}
h4{
    font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif
}
form {
    margin: 0 auto; 
}
.shipping{
    
    padding-left: 200px;
}

input[type=text], select {
    width: 30%;
    padding: 12px 20px;
    margin: 8px 0;
    display: inline-block;
    border: 1px solid gray;
    border-radius: 0px;
    box-sizing: border-box;
}


input[type=email], select {
    width: 30%;
    padding: 12px 20px;
    margin: 8px 0;
    display: inline-block;
    border: 1px solid gray;
    
    box-sizing: border-box;
}


input[type=tel], select {
    width: 30%;
    padding: 12px 20px;
    margin: 8px 0;
    display: inline-block;
    border: 1px solid gray;
  
    box-sizing: border-box;
}


input[type=zip], select {
    width: 30%;
    padding: 12px 20px;
    margin: 8px 0;
    display: inline-block;
    border: 1px solid gray;
    
    box-sizing: border-box;
}
#line1{
    width:62.9%
}
#line2{
    width:62.9%
}
.button {
    background-color:black; 
    border: none;
    color: white;
    left:500px;
    padding: 15px 32px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
    margin: 4px 2px;
    cursor: pointer;
  }
  .box{
      width: 300px;
      border:1px solid grey;
      padding-top: 10px;
      padding: 20px;
      margin-top: 120px;
     
  }
  .box1{
      width: 650px;
      border:1px solid grey;
      margin-left: 130px;;
      margin-top: 60px;
      background-color:  rgb(199, 196, 196);  
  }
  .shipment{
      border: 1px solid grey;
      width: 80%;
      padding: 10px;
  }
  #n1{
     
  left: 0;
  bottom: 0;
  width: 100%;
 text-align: center
}
.input{
        height:0;
        width:0;
        visibility: hidden;
        padding:0;
        margin:0;
        float:right;
}
</style>
<header>
    <nav class="navbar navbar-fixed-top navbar-expand-lg navbar-light bg-dark ">
        <div class="collapse navbar-collapse ">
            <div class="text-light">
                <a style="text-decoration: none; color: white;" th:href="@{/explore}">Shopessentials</a>
            </div>
        </div>
        <!-- Search function -->
        <div class="collapse navbar-collapse">
            <div class="navbar-nav">
                <form class="form-inline my-2 my-lg-0" action="#" th:action="@{/search}" method="POST">
                    <input class="form-control mr-sm-2" type="text" placeholder="Search" name="keyword"
                        aria-label="Search">
                    <button class="btn my-2 my-sm-0" type="submit">&#x1F50E;</button>
                </form>
            </div>
        </div>
        <div class="navbar-nav">
            <div>
                <!-- <button class="btn my-2 my-sm-0">&#x1f464;</button> -->
                <a th:href="@{cartPage}"><button class="btn my-2 my-sm-0"> &#x1f6d2; </button></a>
            </div>
        </div>
        <div class="navbar-nav">
            <div>
                <a style="color: white; font: italic;" class="btn my-2 my-sm-0" th:text="${user}"></a>
                <a th:href="@{/logout}"><button class="btn my-2 my-sm-0"> &#128228; </button></a>
                
            </div>
        </div>
        
    </nav>
    <nav class="navbar navbar-expand-md navbar-light bg-light ">
        <div class="collapse navbar-collapse">
        </div>
        <div class="collapse navbar-collapse">
            <div class="navbar-nav">
                <a class="nav-item nav-link" th:href="@{/allproductspage/1}">Books</a>
                <a class="nav-item nav-link" th:href="@{/allproductspage/2}">Clothing</a>
                <a class="nav-item nav-link" th:href="@{/allproductspage/3}">Sports</a>
                <a class="nav-item nav-link" th:href="@{/allproductspage/5}">Furniture</a>
                <a class="nav-item nav-link" th:href="@{/allproductspage/4}">Stationary</a>
            </div>
        </div>
    </nav>
</header>
<body>
    <div class="row">
        <div class="col-md-8">
            <div class="box1">
           <h1> SHIPPING </h1>
        </div>
    <hr size="1" width="100%" color="grey">
    <div class="shipping">
    <!-- <form action="#"> -->
        <br>
        <!-- <input type="checkbox" name="check" id="check"> -->
        <!-- <label for="check">Enter the Shipping Address here</label> -->
        <br><br>

        <!-- <p>First Name:</p>
      <input type="text"placeholder="First Name"required=""> &emsp;
      <p>Last Name:</p>
       <input type="text"placeholder="Last Name">
       <br><br>
      </form> -->

      <div class="container">
        <div class="row">
        <div class="jumbotron">
        </div>
        
        <div class="col-md-6">
        <form id="distance_form">
        <div class="form-group"><label>All the deliveries   will be sent from Simon Fraser University, University Dr, Burnaby, BC, Canada </label> 
            <!-- <input class="form-control" id="from_places" placeholder="Enter a location" /> <input id="origin" name="origin" required="" type="hidden" /> -->
        </div>
        
        <div class="form-group"><label>Enter the Shipping Address here: </label> <input class="form-control" id="to_places" placeholder="Enter a location" /> <input id="destination" name="destination" required="" type="hidden" /></div>
        <input class="btn btn-primary" type="submit" value="Calculate Charges" /></form>
        </div>
        </div>
        </div>
        
       
       <br><br>

       <p id="calDist" onclick="calculateDistance()"></p>
       <p id="shipCharges" onclick="calculateDistance()"></p>
       <p id="time" onclick="calculateDistance()"></p>
       <br> <br>
       
       <form id="f1" action="#" th:action="@{/Addressinfo}" method="POST">
       <input type="text" class="input"  id="address" placeholder="address" name="address" required>
       <input type="text" class="input" id="distance" placeholder="distance" name="distance"  required>
       <input type="text" class="input" id="time1"    placeholder="time" name= "time" required>
       <input type="number" class="input" id="charges"  placeholder="charges" name="charges" required> 
        
       <input id ="validation" type="submit" class="button" value="Place Order">
        
    </form> 

       <!-- <div><h4>Enter Contact Info</h4></div>
       <input type="email" placeholder="Email"> &emsp;
       <input type="tel" placeholder="Phone Number"
       required> -->


     <!-- <a href='/success'><button class="button">Continue</button></a> -->
    </div> 
        </div>
       
      <div class="col-md-4">
         <div class="box">
             <h2>Summary</h2>
        <p>Subtotal
            &emsp; &emsp; &emsp; &emsp; $
            <span th:text="${subtotal}" id="subtotal"></span></p>
        <p>Estimated Tax
            &emsp; &emsp;   $
            <span th:text="${tax}" id="tax"></span></p>
        <p>Discounts
            &emsp; &emsp; &emsp; &nbsp;  $
            <span id="discount">0.00</span> </p>
        <p>Shipping
            &emsp;&emsp;&emsp;&ensp;&ensp; $
            <span id="shipping">--</span></p>
        <hr size="4" width="90%" color="black"> 
            <p>Total
                &emsp; &emsp; &emsp; &emsp; &ensp;&ensp; $
                <span id="Total">--</span></p>
        <hr size="4" width="90%" color="black"> 
        <br>
        
        </div> 
        <div> 
            <br><br>
        </div>
    </div>
        
    </div>

    <script>
    function initMap() {
            // add input listeners
            google.maps.event.addDomListener(window, 'load', 
            function () 
            {
                // var input = document.getElementById('from_places');
                // var from_places = new google.maps.places.Autocomplete(input);
                // var from_places = new google.maps.places.Autocomplete("Simon Fraser University");
                // var from_places = document.getElementById('from_places');
               
            //     google.maps.event.addListener('place_changed', function () {
            //         var from_place = from_places.getPlace();
            //         var from_address = from_place.formatted_address;
            //         $('#from_places').val(from_address);
            // });
            var to_places = new google.maps.places.Autocomplete(document.getElementById('to_places'));
                google.maps.event.addListener(to_places, 'place_changed', function () {
                     to_place = to_places.getPlace();
                     var to_address = to_place.formatted_address;
                    $('#to_places').val(to_address);
                });
    
            });
            // calculate distance
        function calculateDistance() {
            // var origin = $('#origin').val();
            var origin = "Simon Fraser University, University Dr, Burnaby, BC, Canada";
            var destination = $('#to_places').val();
            document.getElementById("address").value = destination; 
            console.log($('#to_places').val());
            var service = new google.maps.DistanceMatrixService();
            service.getDistanceMatrix(
                {
                    origins: [origin],
                    destinations: [destination],
                    travelMode: google.maps.TravelMode.DRIVING,
                    unitSystem: google.maps.UnitSystem.IMPERIAL, // miles and feet.
                    // unitSystem: google.maps.UnitSystem.metric, // kilometers and meters.
                    avoidHighways: false,
                    avoidTolls: false
                }, callback);
        }
            // get distance results
            function callback(response, status) {
                if (status != google.maps.DistanceMatrixStatus.OK) {
                    $('#result').html(err);
                } else {
                    var origin = response.originAddresses[0];
                    var destination = response.destinationAddresses[0];
                    console.log(response.originAddresses[0]);
                    console.log(response.destinationAddresses[0]);
                    
                    if (response.rows[0].elements[0].status === "ZERO_RESULTS") {
                        $('#result').html("Delivery not possible!");
                    } else {
                        var distance = response.rows[0].elements[0].distance;
                        var duration = response.rows[0].elements[0].duration;
    
                        console.log(response.rows[0].elements[0].distance);
                        console.log(response.rows[0].elements[0].duration);
    
                        var distance_in_kilo = distance.value / 1000; // the kilom
                        var distance_in_mile = distance.value / 1609.34; // the mile
                        var duration_text = duration.text;
                        var duration_value = duration.value;
    
                        console.log(distance_in_kilo);
                        console.log(distance_in_mile);
                        console.log(duration_text);
                        document.getElementById('calDist').innerHTML = "Distance is " + distance_in_kilo + "  kilometres"; 
                        document.getElementById('distance').value = distance_in_kilo;
                        sessionStorage.setItem("distance", distance_in_kilo);
                        // $('#calDist').html("Distance is " + distance_in_kilo + "kilometres");

                        if (isNaN(shipKms(distance_in_kilo)))
                        {
                            document.getElementById("shipCharges").innerHTML = "The address out of the Delivery zone";
                        }

                        else
                        {
                            sessionStorage.setItem("shipCharges", shipKms(distance_in_kilo));
                            sessionStorage.setItem("Time", duration_text);
                            document.getElementById("shipCharges").innerHTML = "The charges are $" + shipKms(distance_in_kilo);
                            document.getElementById("time").innerHTML = "Expected time for the delivery is minimum 2 day for shipping and " + duration_text + " for travel time";
                            document.getElementById("charges").value = shipKms(distance_in_kilo);
                            document.getElementById("time1").value = duration_text;
                            var Subtotal1 = document.getElementById("subtotal").innerHTML;
                            var Tax1 = document.getElementById("tax").innerHTML;
                            var Tax = parseFloat(Tax1);
                            var Subtotal = parseFloat(Subtotal1);
                            document.getElementById("shipping").innerHTML = shipKms(distance_in_kilo);
                            var Total = Subtotal + Tax + shipKms(distance_in_kilo);
                            document.getElementById("Total").innerHTML = Total;
                        }
    
                        $('#in_mile').text(distance_in_mile.toFixed(2));
                        $('#in_kilo').text(distance_in_kilo.toFixed(2));
                        $('#duration_text').text(duration_text);
                        $('#duration_value').text(duration_value);
                        $('#from').text(origin);
                        $('#to').text(destination);

                    }
                }
            }

                function shipKms(dist)
                {
                    var shipCharge = 0;
                    if (dist <= 500)
                    {
                        shipCharge = 10;
                        return shipCharge;
                    }
                    else if (dist > 500 && dist <= 1000)
                    {
                        shipCharge = 13;
                        return shipCharge;
                    }
                    else if (dist > 1000 && dist <= 1250)
                    {
                        shipCharge = 15;
                        return shipCharge;
                    }
                    else if (dist > 1250 && dist <= 1500)
                    {
                        shipCharge = 18;
                        return shipCharge;
                    }
                    else if (dist > 1500 && dist <= 2000)
                    {
                        shipCharge = 20;
                        return shipCharge;
                    }
                    else if (dist > 2000 && dist <= 3000)
                    {
                        shipCharge = 22;
                        return shipCharge;
                    }
                    else
                    {
                        shipCharge = 25;
                        return shipCharge;
                    }
                }

            // print results on submit the form
            $('#distance_form').submit(function(e){
                e.preventDefault();
                calculateDistance();
            });

    
        };

        function cartsubTotal(){
        const total=[];
        const qty1=[];
        const items=document.querySelectorAll("#price2");
        const quantity=document.querySelectorAll("#qty");
        items.forEach(function(item){
            total.push(parseFloat(item.textContent));
           
         });
         quantity.forEach(function(quan){
            qty1.push(parseFloat(quan.textContent));
           
         });
         console.log(qty1);
        console.log(total);
        
        let sum=0;
    for(var i=0;i<total.length;i++)
        sum += total[i]*qty1[i];
       
       console.log(sum);
       document.getElementById('subtotal').textContent=sum;
       return sum;
    }
   
    </script>
    
</body>

<footer class="page-footer font-small elegant-color bg-dark" id="n1">
    <div class="footer-copyright text-center py-3 text-light">
        © 2020 Copyright Shopessentials
    </div>
</html>
